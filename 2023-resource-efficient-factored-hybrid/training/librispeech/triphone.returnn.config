#!rnn.py


import numpy as np

from returnn.tf.util.data import Dim

__time_tag__ = Dim(dimension=None, kind=Dim.Types.Spatial, description="time")


batch_size = 12500
cache_size = "0"
chunking = "400:200"
cleanup_old_models = {"keep": [550, 600], "keep_best_n": 3}
debug_print_layer_output_template = True
dev = {
    "class": "ExternSprintDataset",
    "partitionEpoch": 1,
    "sprintConfigStr": "--config=rasr.dev.config --*.LOGFILE=nn-trainer.dev.log --*.TASK=1",
    "sprintTrainerExecPath": "/u/raissi/dev/rasr_github/rasr_tf2/arch/linux-x86_64-standard/nn-trainer.linux-x86_64-standard",
}
device = "gpu"
extern_data = {
    "centerState": {
        "available_for_inference": True,
        "dim": 252,
        "dtype": "int32",
        "same_dim_tags_as": {"T": __time_tag__},
        "sparse": True,
    },
    "classes": {
        "available_for_inference": True,
        "dim": 444528,
        "dtype": "int32",
        "same_dim_tags_as": {"T": __time_tag__},
        "sparse": True,
    },
    "data": {"dim": 50, "same_dim_tags_as": {"T": __time_tag__}},
    "futureLabel": {
        "available_for_inference": True,
        "dim": 42,
        "dtype": "int32",
        "same_dim_tags_as": {"T": __time_tag__},
        "sparse": True,
    },
    "pastLabel": {
        "available_for_inference": True,
        "dim": 42,
        "dtype": "int32",
        "same_dim_tags_as": {"T": __time_tag__},
        "sparse": True,
    },
}
gradient_noise = 0.0
learning_rate_control = "constant"
learning_rate_file = "lr.log"
learning_rates = [
    3.6913580246913584e-05,
    4.0493827160493827e-05,
    4.4074074074074076e-05,
    4.7654320987654325e-05,
    5.1234567901234574e-05,
    5.4814814814814817e-05,
    5.8395061728395066e-05,
    6.197530864197531e-05,
    6.555555555555556e-05,
    6.91358024691358e-05,
    7.271604938271606e-05,
    7.62962962962963e-05,
    7.987654320987654e-05,
    8.34567901234568e-05,
    8.703703703703704e-05,
    9.061728395061728e-05,
    9.419753086419754e-05,
    9.777777777777778e-05,
    0.00010135802469135804,
    0.00010493827160493828,
    0.00010851851851851852,
    0.00011209876543209878,
    0.00011567901234567902,
    0.00011925925925925926,
    0.0001228395061728395,
    0.00012641975308641976,
    0.00013000000000000002,
    0.00013358024691358024,
    0.0001371604938271605,
    0.00014074074074074076,
    0.00014432098765432099,
    0.00014790123456790124,
    0.0001514814814814815,
    0.00015506172839506173,
    0.000158641975308642,
    0.00016222222222222224,
    0.00016580246913580247,
    0.00016938271604938275,
    0.00017296296296296298,
    0.0001765432098765432,
    0.0001801234567901235,
    0.00018370370370370372,
    0.00018728395061728395,
    0.00019086419753086423,
    0.00019444444444444446,
    0.0001980246913580247,
    0.00020160493827160497,
    0.0002051851851851852,
    0.00020876543209876543,
    0.0002123456790123457,
    0.00021592592592592594,
    0.00021950617283950617,
    0.00022308641975308645,
    0.00022666666666666668,
    0.0002302469135802469,
    0.0002338271604938272,
    0.00023740740740740742,
    0.00024098765432098765,
    0.00024456790123456794,
    0.00024814814814814816,
    0.0002517283950617284,
    0.0002553086419753087,
    0.0002588888888888889,
    0.00026246913580246913,
    0.0002660493827160494,
    0.00026962962962962965,
    0.0002732098765432099,
    0.00027679012345679016,
    0.0002803703703703704,
    0.00028395061728395067,
    0.0002875308641975309,
    0.00029111111111111113,
    0.0002946913580246914,
    0.00029827160493827164,
    0.00030185185185185187,
    0.00030543209876543215,
    0.0003090123456790124,
    0.0003125925925925926,
    0.0003161728395061729,
    0.0003197530864197531,
    0.00032333333333333335,
    0.00032691358024691363,
    0.00033049382716049386,
    0.0003340740740740741,
    0.0003376543209876544,
    0.0003412345679012346,
    0.00034481481481481483,
    0.0003483950617283951,
    0.00035197530864197534,
    0.00035555555555555557,
    0.00035913580246913586,
    0.0003627160493827161,
    0.0003662962962962963,
    0.0003698765432098766,
    0.0003734567901234568,
    0.00037703703703703705,
    0.00038061728395061734,
    0.00038419753086419757,
    0.0003877777777777778,
    0.0003913580246913581,
    0.0003949382716049383,
    0.00039851851851851854,
    0.0004020987654320988,
    0.00040567901234567905,
    0.0004092592592592593,
    0.00041283950617283956,
    0.0004164197530864198,
    0.00042,
    0.0004235802469135803,
    0.00042716049382716053,
    0.00043074074074074076,
    0.00043432098765432104,
    0.00043790123456790127,
    0.0004414814814814815,
    0.0004450617283950618,
    0.000448641975308642,
    0.00045222222222222224,
    0.0004558024691358025,
    0.00045938271604938275,
    0.000462962962962963,
    0.00046654320987654326,
    0.0004701234567901235,
    0.0004737037037037037,
    0.000477283950617284,
    0.00048086419753086423,
    0.00048444444444444446,
    0.00048802469135802475,
    0.0004916049382716049,
    0.0004951851851851852,
    0.0004987654320987655,
    0.0005023456790123457,
    0.0005059259259259259,
    0.0005095061728395062,
    0.0005130864197530864,
    0.0005166666666666667,
    0.000520246913580247,
    0.0005238271604938273,
    0.0005274074074074074,
    0.0005309876543209877,
    0.000534567901234568,
    0.0005381481481481482,
    0.0005417283950617284,
    0.0005453086419753087,
    0.0005488888888888889,
    0.0005524691358024692,
    0.0005560493827160495,
    0.0005596296296296296,
    0.0005632098765432099,
    0.0005667901234567902,
    0.0005703703703703704,
    0.0005739506172839507,
    0.000577530864197531,
    0.0005811111111111111,
    0.0005846913580246914,
    0.0005882716049382717,
    0.0005918518518518519,
    0.0005954320987654322,
    0.0005990123456790124,
    0.0006025925925925926,
    0.0006061728395061729,
    0.0006097530864197532,
    0.0006133333333333334,
    0.0006169135802469136,
    0.0006204938271604939,
    0.0006240740740740741,
    0.0006276543209876544,
    0.0006312345679012347,
    0.0006348148148148148,
    0.0006383950617283951,
    0.0006419753086419754,
    0.0006455555555555556,
    0.0006491358024691359,
    0.0006527160493827161,
    0.0006562962962962963,
    0.0006598765432098766,
    0.0006634567901234569,
    0.0006670370370370371,
    0.0006706172839506173,
    0.0006741975308641976,
    0.0006777777777777778,
    0.0006813580246913581,
    0.0006849382716049384,
    0.0006885185185185185,
    0.0006920987654320988,
    0.0006956790123456791,
    0.0006992592592592593,
    0.0007028395061728396,
    0.0007064197530864198,
    0.00071,
    0.0007135802469135803,
    0.0007171604938271606,
    0.0007207407407407408,
    0.000724320987654321,
    0.0007279012345679013,
    0.0007314814814814815,
    0.0007350617283950618,
    0.0007386419753086421,
    0.0007422222222222222,
    0.0007458024691358025,
    0.0007493827160493828,
    0.000752962962962963,
    0.0007565432098765433,
    0.0007601234567901235,
    0.0007637037037037037,
    0.000767283950617284,
    0.0007708641975308643,
    0.0007744444444444445,
    0.0007780246913580247,
    0.000781604938271605,
    0.0007851851851851852,
    0.0007887654320987655,
    0.0007923456790123458,
    0.0007959259259259259,
    0.0007995061728395062,
    0.0008030864197530865,
    0.0008066666666666667,
    0.000810246913580247,
    0.0008138271604938273,
    0.0008174074074074074,
    0.0008209876543209877,
    0.000824567901234568,
    0.0008281481481481482,
    0.0008317283950617285,
    0.0008353086419753087,
    0.0008388888888888889,
    0.0008424691358024692,
    0.0008460493827160495,
    0.0008496296296296296,
    0.0008532098765432099,
    0.0008567901234567902,
    0.0008603703703703704,
    0.0008639506172839507,
    0.000867530864197531,
    0.0008711111111111111,
    0.0008746913580246914,
    0.0008782716049382717,
    0.0008818518518518519,
    0.0008854320987654322,
    0.0008890123456790124,
    0.0008925925925925926,
    0.0008961728395061729,
    0.0008997530864197532,
    0.0009033333333333334,
    0.0009069135802469136,
    0.0009104938271604939,
    0.0009140740740740741,
    0.0009176543209876544,
    0.0009212345679012347,
    0.0009248148148148148,
    0.0009283950617283951,
    0.0009319753086419754,
    0.0009355555555555556,
    0.0009391358024691359,
    0.0009427160493827161,
    0.0009462962962962963,
    0.0009498765432098766,
    0.0009534567901234569,
    0.0009570370370370371,
    0.0009606172839506173,
    0.0009641975308641976,
    0.0009677777777777778,
    0.0009713580246913581,
    0.0009749382716049384,
    0.0009785185185185185,
    0.0009820987654320988,
    0.000985679012345679,
    0.0009892592592592592,
    0.0009928395061728395,
    0.0009964197530864197,
    0.001,
    0.0009964197530864197,
    0.0009928395061728395,
    0.0009892592592592592,
    0.000985679012345679,
    0.0009820987654320988,
    0.0009785185185185185,
    0.0009749382716049383,
    0.0009713580246913581,
    0.0009677777777777778,
    0.0009641975308641975,
    0.0009606172839506173,
    0.0009570370370370371,
    0.0009534567901234568,
    0.0009498765432098766,
    0.0009462962962962963,
    0.000942716049382716,
    0.0009391358024691359,
    0.0009355555555555556,
    0.0009319753086419753,
    0.0009283950617283951,
    0.0009248148148148148,
    0.0009212345679012346,
    0.0009176543209876544,
    0.0009140740740740741,
    0.0009104938271604938,
    0.0009069135802469136,
    0.0009033333333333334,
    0.0008997530864197531,
    0.0008961728395061729,
    0.0008925925925925926,
    0.0008890123456790123,
    0.0008854320987654322,
    0.0008818518518518519,
    0.0008782716049382716,
    0.0008746913580246914,
    0.0008711111111111111,
    0.0008675308641975308,
    0.0008639506172839506,
    0.0008603703703703704,
    0.0008567901234567901,
    0.0008532098765432099,
    0.0008496296296296296,
    0.0008460493827160494,
    0.0008424691358024691,
    0.0008388888888888889,
    0.0008353086419753086,
    0.0008317283950617285,
    0.0008281481481481482,
    0.0008245679012345679,
    0.0008209876543209876,
    0.0008174074074074074,
    0.0008138271604938271,
    0.000810246913580247,
    0.0008066666666666667,
    0.0008030864197530864,
    0.0007995061728395061,
    0.0007959259259259259,
    0.0007923456790123457,
    0.0007887654320987655,
    0.0007851851851851852,
    0.0007816049382716049,
    0.0007780246913580246,
    0.0007744444444444445,
    0.0007708641975308642,
    0.000767283950617284,
    0.0007637037037037037,
    0.0007601234567901234,
    0.0007565432098765432,
    0.000752962962962963,
    0.0007493827160493827,
    0.0007458024691358025,
    0.0007422222222222222,
    0.000738641975308642,
    0.0007350617283950617,
    0.0007314814814814815,
    0.0007279012345679012,
    0.000724320987654321,
    0.0007207407407407408,
    0.0007171604938271605,
    0.0007135802469135802,
    0.00071,
    0.0007064197530864197,
    0.0007028395061728396,
    0.0006992592592592593,
    0.000695679012345679,
    0.0006920987654320987,
    0.0006885185185185185,
    0.0006849382716049383,
    0.0006813580246913581,
    0.0006777777777777778,
    0.0006741975308641975,
    0.0006706172839506172,
    0.0006670370370370371,
    0.0006634567901234568,
    0.0006598765432098766,
    0.0006562962962962963,
    0.000652716049382716,
    0.0006491358024691357,
    0.0006455555555555556,
    0.0006419753086419753,
    0.0006383950617283951,
    0.0006348148148148148,
    0.0006312345679012346,
    0.0006276543209876543,
    0.0006240740740740741,
    0.0006204938271604938,
    0.0006169135802469136,
    0.0006133333333333334,
    0.0006097530864197531,
    0.0006061728395061728,
    0.0006025925925925926,
    0.0005990123456790123,
    0.0005954320987654322,
    0.0005918518518518519,
    0.0005882716049382716,
    0.0005846913580246913,
    0.0005811111111111111,
    0.0005775308641975308,
    0.0005739506172839507,
    0.0005703703703703704,
    0.0005667901234567901,
    0.0005632098765432098,
    0.0005596296296296296,
    0.0005560493827160494,
    0.0005524691358024692,
    0.0005488888888888889,
    0.0005453086419753086,
    0.0005417283950617283,
    0.0005381481481481482,
    0.0005345679012345679,
    0.0005309876543209877,
    0.0005274074074074074,
    0.0005238271604938271,
    0.0005202469135802469,
    0.0005166666666666667,
    0.0005130864197530864,
    0.0005095061728395061,
    0.0005059259259259259,
    0.0005023456790123457,
    0.0004987654320987654,
    0.0004951851851851852,
    0.0004916049382716049,
    0.00048802469135802464,
    0.00048444444444444446,
    0.0004808641975308642,
    0.0004772839506172839,
    0.0004737037037037037,
    0.00047012345679012344,
    0.00046654320987654316,
    0.000462962962962963,
    0.0004593827160493827,
    0.0004558024691358024,
    0.00045222222222222224,
    0.00044864197530864196,
    0.0004450617283950617,
    0.0004414814814814815,
    0.0004379012345679012,
    0.00043432098765432093,
    0.00043074074074074076,
    0.0004271604938271605,
    0.0004235802469135802,
    0.00042,
    0.00041641975308641973,
    0.00041283950617283945,
    0.0004092592592592593,
    0.000405679012345679,
    0.0004020987654320987,
    0.00039851851851851854,
    0.00039493827160493825,
    0.00039135802469135797,
    0.0003877777777777778,
    0.0003841975308641975,
    0.00038061728395061723,
    0.00037703703703703705,
    0.00037345679012345677,
    0.0003698765432098765,
    0.0003662962962962963,
    0.00036271604938271603,
    0.00035913580246913575,
    0.00035555555555555557,
    0.0003519753086419753,
    0.000348395061728395,
    0.00034481481481481483,
    0.00034123456790123455,
    0.00033765432098765427,
    0.0003340740740740741,
    0.0003304938271604938,
    0.0003269135802469135,
    0.00032333333333333335,
    0.00031975308641975307,
    0.0003161728395061728,
    0.0003125925925925926,
    0.0003090123456790123,
    0.00030543209876543204,
    0.00030185185185185187,
    0.0002982716049382716,
    0.0002946913580246913,
    0.00029111111111111113,
    0.00028753086419753084,
    0.00028395061728395056,
    0.0002803703703703704,
    0.0002767901234567901,
    0.0002732098765432098,
    0.00026962962962962965,
    0.00026604938271604936,
    0.0002624691358024691,
    0.0002588888888888889,
    0.0002553086419753086,
    0.00025172839506172834,
    0.00024814814814814816,
    0.0002445679012345679,
    0.0002409876543209876,
    0.00023740740740740742,
    0.00023382716049382714,
    0.00023024691358024686,
    0.00022666666666666668,
    0.0002230864197530864,
    0.00021950617283950612,
    0.00021592592592592594,
    0.00021234567901234566,
    0.00020876543209876538,
    0.0002051851851851852,
    0.00020160493827160492,
    0.00019802469135802464,
    0.00019444444444444446,
    0.00019086419753086418,
    0.0001872839506172839,
    0.00018370370370370372,
    0.00018012345679012344,
    0.00017654320987654315,
    0.00017296296296296298,
    0.0001693827160493827,
    0.0001658024691358024,
    0.00016222222222222224,
    0.00015864197530864196,
    0.00015506172839506167,
    0.0001514814814814815,
    0.00014790123456790121,
    0.00014432098765432093,
    0.00014074074074074076,
    0.00013716049382716047,
    0.0001335802469135802,
    0.00013000000000000002,
    0.00012641975308641973,
    0.00012283950617283945,
    0.00011925925925925927,
    0.00011567901234567899,
    0.00011209876543209871,
    0.00010851851851851853,
    0.00010493827160493825,
    0.00010135802469135797,
    9.77777777777778e-05,
    9.419753086419751e-05,
    9.061728395061723e-05,
    8.703703703703705e-05,
    8.345679012345677e-05,
    7.987654320987649e-05,
    7.629629629629631e-05,
    7.271604938271603e-05,
    6.913580246913575e-05,
    6.555555555555557e-05,
    6.197530864197529e-05,
    5.8395061728395005e-05,
    5.481481481481483e-05,
    5.123456790123455e-05,
    4.7654320987654264e-05,
    4.407407407407409e-05,
    4.0493827160493806e-05,
    3.691358024691352e-05,
    3.333333333333335e-05,
    3.333333333333335e-05,
    3.278531073446329e-05,
    3.2237288135593235e-05,
    3.168926553672318e-05,
    3.114124293785312e-05,
    3.0593220338983065e-05,
    3.004519774011301e-05,
    2.949717514124295e-05,
    2.8949152542372895e-05,
    2.8401129943502838e-05,
    2.785310734463278e-05,
    2.7305084745762725e-05,
    2.6757062146892668e-05,
    2.620903954802261e-05,
    2.5661016949152555e-05,
    2.5112994350282498e-05,
    2.456497175141244e-05,
    2.4016949152542385e-05,
    2.3468926553672328e-05,
    2.292090395480227e-05,
    2.2372881355932215e-05,
    2.1824858757062158e-05,
    2.12768361581921e-05,
    2.0728813559322045e-05,
    2.0180790960451985e-05,
    1.9632768361581928e-05,
    1.908474576271187e-05,
    1.8536723163841815e-05,
    1.7988700564971758e-05,
    1.74406779661017e-05,
    1.6892655367231644e-05,
    1.6344632768361588e-05,
    1.579661016949153e-05,
    1.5248587570621474e-05,
    1.4700564971751418e-05,
    1.4152542372881361e-05,
    1.3604519774011304e-05,
    1.3056497175141248e-05,
    1.2508474576271191e-05,
    1.1960451977401134e-05,
    1.1412429378531078e-05,
    1.0864406779661021e-05,
    1.0316384180790964e-05,
    9.768361581920908e-06,
    9.220338983050851e-06,
    8.672316384180794e-06,
    8.124293785310738e-06,
    7.576271186440681e-06,
    7.028248587570621e-06,
    6.480225988700564e-06,
    5.932203389830507e-06,
    5.384180790960451e-06,
    4.836158192090394e-06,
    4.288135593220337e-06,
    3.7401129943502806e-06,
    3.192090395480224e-06,
    2.6440677966101673e-06,
    2.0960451977401106e-06,
    1.5480225988700539e-06,
    1e-06,
]
log = ["./returnn.log"]
log_batch_size = True
log_verbosity = 3
max_len_feature = 15
max_len_time = 20
max_reps_feature = 1
max_reps_time = 20
min_learning_rate = 1e-06
min_reps_feature = 0
min_reps_time = 0
model = "/u/mgunz/setups/2023-04--tf2-test/work/i6_core/returnn/rasr_training/ReturnnRasrTrainingJob.ioels4lt7xHK/output/models/epoch"
n_contexts = 42
n_states_per_phone = 3
network = {
    "aux_006_center-output": {
        "class": "softmax",
        "from": "aux_006_linear2-diphone",
        "loss": "ce",
        "loss_opts": {"focal_loss_factor": 2.0},
        "loss_scale": 0.5,
        "n_out": 252,
        "target": "centerState",
    },
    "aux_006_length_masked": {
        "axis": "T",
        "class": "slice_nd",
        "from": ["aux_6_upsampled0"],
        "size": __time_tag__,
        "start": 0,
    },
    "aux_006_linear1-diphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "aux_006_length_masked",
        "n_out": 544,
    },
    "aux_006_linear1-leftContext": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "aux_006_length_masked",
        "n_out": 512,
    },
    "aux_006_linear1-triphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "aux_006_length_masked",
        "n_out": 672,
    },
    "aux_006_linear2-diphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "aux_006_linear1-diphone",
        "n_out": 544,
    },
    "aux_006_linear2-leftContext": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "aux_006_linear1-leftContext",
        "n_out": 512,
    },
    "aux_006_linear2-triphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "aux_006_linear1-triphone",
        "n_out": 672,
    },
    "aux_6_upsampled0": {
        "activation": "relu",
        "class": "transposed_conv",
        "filter_size": (3,),
        "from": ["enc_006"],
        "n_out": 512,
        "strides": (3,),
        "with_bias": True,
    },
    "center-output": {
        "class": "softmax",
        "from": "linear2-diphone",
        "loss": "ce",
        "loss_opts": {"focal_loss_factor": 2.0},
        "n_out": 252,
        "target": "centerState",
    },
    "centerPhoneme": {
        "class": "eval",
        "eval": "tf.math.floordiv(source(0), 3)",
        "from": "popWordEnd",
        "out_type": {"dim": 42, "dtype": "int32", "sparse": True},
    },
    "centerState": {
        "class": "eval",
        "eval": "tf.math.floordiv(source(0), 42)",
        "from": "popFutureLabel",
        "out_type": {"dim": 252, "dtype": "int32", "sparse": True},
        "register_as_extern_data": "centerState",
    },
    "conv0_0": {
        "activation": None,
        "class": "conv",
        "filter_size": (3, 3),
        "from": "source0",
        "in_spatial_dims": ["T", "dim:50"],
        "n_out": 32,
        "padding": "same",
        "with_bias": True,
    },
    "conv0_1": {
        "activation": "relu",
        "class": "conv",
        "filter_size": (3, 3),
        "from": "conv0_0",
        "in_spatial_dims": ["T", "dim:50"],
        "n_out": 32,
        "padding": "same",
        "with_bias": True,
    },
    "conv0p": {
        "class": "pool",
        "from": "conv0_1",
        "in_spatial_dims": ["T", "dim:50"],
        "mode": "max",
        "padding": "same",
        "pool_size": (1, 2),
        "strides": (1, 2),
    },
    "conv1_0": {
        "activation": None,
        "class": "conv",
        "filter_size": (3, 3),
        "from": "conv0p",
        "in_spatial_dims": ["T", "dim:25"],
        "n_out": 64,
        "padding": "same",
        "with_bias": True,
    },
    "conv1_1": {
        "activation": "relu",
        "class": "conv",
        "filter_size": (3, 3),
        "from": "conv1_0",
        "in_spatial_dims": ["T", "dim:25"],
        "n_out": 64,
        "padding": "same",
        "with_bias": True,
    },
    "conv1p": {
        "class": "pool",
        "from": "conv1_1",
        "in_spatial_dims": ["T", "dim:25"],
        "mode": "max",
        "padding": "same",
        "pool_size": (1, 1),
        "strides": (1, 1),
    },
    "conv_merged": {
        "axes": ["stag:conv0p:conv:s1", "dim:64"],
        "class": "merge_dims",
        "from": "conv1p",
    },
    "currentState": {
        "L2": 1e-06,
        "activation": None,
        "class": "linear",
        "from": "centerState",
        "n_out": 128,
        "with_bias": False,
    },
    "embedding": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["feature_stacking_merged"],
        "n_out": 512,
        "with_bias": True,
    },
    "embedding_dropout": {"class": "dropout", "dropout": 0.0, "from": ["embedding"]},
    "enc_001": {"class": "copy", "from": ["enc_001_ff2_out"]},
    "enc_001_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_001_conv_pointwise1"],
    },
    "enc_001_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_001_conv_layer_norm"],
    },
    "enc_001_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_001_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_001_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_001_conv_pointwise2"],
    },
    "enc_001_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_001_conv_depthwise"],
    },
    "enc_001_conv_laynorm": {"class": "layer_norm", "from": ["enc_001_self_att_out"]},
    "enc_001_conv_output": {
        "class": "combine",
        "from": ["enc_001_self_att_out", "enc_001_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_001_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_001_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_001_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_001_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_001_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_001_ff1_conv2"],
    },
    "enc_001_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_001_ff1_drop"],
    },
    "enc_001_ff1_laynorm": {"class": "layer_norm", "from": ["embedding_dropout"]},
    "enc_001_ff1_out": {
        "class": "combine",
        "from": ["embedding_dropout", "enc_001_ff1_drop_half"],
        "kind": "add",
    },
    "enc_001_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_001_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_001_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_001_ff2_conv2"],
    },
    "enc_001_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_001_ff2_drop"],
    },
    "enc_001_ff2_laynorm": {"class": "layer_norm", "from": ["enc_001_conv_output"]},
    "enc_001_ff2_out": {
        "class": "combine",
        "from": ["enc_001_conv_output", "enc_001_ff2_drop_half"],
        "kind": "add",
    },
    "enc_001_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_001_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_self_att_laynorm"],
        "key_shift": "enc_001_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_001_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_001_self_att_lin"],
    },
    "enc_001_self_att_laynorm": {"class": "layer_norm", "from": ["enc_001_ff1_out"]},
    "enc_001_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_001_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_001_self_att_out": {
        "class": "combine",
        "from": ["enc_001_ff1_out", "enc_001_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_002": {"class": "copy", "from": ["enc_002_ff2_out"]},
    "enc_002_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_002_conv_pointwise1"],
    },
    "enc_002_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_002_conv_layer_norm"],
    },
    "enc_002_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_002_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_002_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_002_conv_pointwise2"],
    },
    "enc_002_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_002_conv_depthwise"],
    },
    "enc_002_conv_laynorm": {"class": "layer_norm", "from": ["enc_002_self_att_out"]},
    "enc_002_conv_output": {
        "class": "combine",
        "from": ["enc_002_self_att_out", "enc_002_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_002_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_002_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_002_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_002_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_002_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_002_ff1_conv2"],
    },
    "enc_002_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_002_ff1_drop"],
    },
    "enc_002_ff1_laynorm": {"class": "layer_norm", "from": ["enc_001"]},
    "enc_002_ff1_out": {
        "class": "combine",
        "from": ["enc_001", "enc_002_ff1_drop_half"],
        "kind": "add",
    },
    "enc_002_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_002_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_002_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_002_ff2_conv2"],
    },
    "enc_002_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_002_ff2_drop"],
    },
    "enc_002_ff2_laynorm": {"class": "layer_norm", "from": ["enc_002_conv_output"]},
    "enc_002_ff2_out": {
        "class": "combine",
        "from": ["enc_002_conv_output", "enc_002_ff2_drop_half"],
        "kind": "add",
    },
    "enc_002_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_002_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_self_att_laynorm"],
        "key_shift": "enc_002_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_002_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_002_self_att_lin"],
    },
    "enc_002_self_att_laynorm": {"class": "layer_norm", "from": ["enc_002_ff1_out"]},
    "enc_002_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_002_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_002_self_att_out": {
        "class": "combine",
        "from": ["enc_002_ff1_out", "enc_002_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_003": {"class": "copy", "from": ["enc_003_ff2_out"]},
    "enc_003_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_003_conv_pointwise1"],
    },
    "enc_003_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_003_conv_layer_norm"],
    },
    "enc_003_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_003_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_003_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_003_conv_pointwise2"],
    },
    "enc_003_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_003_conv_depthwise"],
    },
    "enc_003_conv_laynorm": {"class": "layer_norm", "from": ["enc_003_self_att_out"]},
    "enc_003_conv_output": {
        "class": "combine",
        "from": ["enc_003_self_att_out", "enc_003_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_003_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_003_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_003_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_003_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_003_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_003_ff1_conv2"],
    },
    "enc_003_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_003_ff1_drop"],
    },
    "enc_003_ff1_laynorm": {"class": "layer_norm", "from": ["enc_002"]},
    "enc_003_ff1_out": {
        "class": "combine",
        "from": ["enc_002", "enc_003_ff1_drop_half"],
        "kind": "add",
    },
    "enc_003_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_003_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_003_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_003_ff2_conv2"],
    },
    "enc_003_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_003_ff2_drop"],
    },
    "enc_003_ff2_laynorm": {"class": "layer_norm", "from": ["enc_003_conv_output"]},
    "enc_003_ff2_out": {
        "class": "combine",
        "from": ["enc_003_conv_output", "enc_003_ff2_drop_half"],
        "kind": "add",
    },
    "enc_003_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_003_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_self_att_laynorm"],
        "key_shift": "enc_003_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_003_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_003_self_att_lin"],
    },
    "enc_003_self_att_laynorm": {"class": "layer_norm", "from": ["enc_003_ff1_out"]},
    "enc_003_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_003_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_003_self_att_out": {
        "class": "combine",
        "from": ["enc_003_ff1_out", "enc_003_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_004": {"class": "copy", "from": ["enc_004_ff2_out"]},
    "enc_004_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_004_conv_pointwise1"],
    },
    "enc_004_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_004_conv_layer_norm"],
    },
    "enc_004_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_004_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_004_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_004_conv_pointwise2"],
    },
    "enc_004_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_004_conv_depthwise"],
    },
    "enc_004_conv_laynorm": {"class": "layer_norm", "from": ["enc_004_self_att_out"]},
    "enc_004_conv_output": {
        "class": "combine",
        "from": ["enc_004_self_att_out", "enc_004_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_004_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_004_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_004_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_004_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_004_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_004_ff1_conv2"],
    },
    "enc_004_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_004_ff1_drop"],
    },
    "enc_004_ff1_laynorm": {"class": "layer_norm", "from": ["enc_003"]},
    "enc_004_ff1_out": {
        "class": "combine",
        "from": ["enc_003", "enc_004_ff1_drop_half"],
        "kind": "add",
    },
    "enc_004_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_004_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_004_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_004_ff2_conv2"],
    },
    "enc_004_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_004_ff2_drop"],
    },
    "enc_004_ff2_laynorm": {"class": "layer_norm", "from": ["enc_004_conv_output"]},
    "enc_004_ff2_out": {
        "class": "combine",
        "from": ["enc_004_conv_output", "enc_004_ff2_drop_half"],
        "kind": "add",
    },
    "enc_004_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_004_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_self_att_laynorm"],
        "key_shift": "enc_004_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_004_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_004_self_att_lin"],
    },
    "enc_004_self_att_laynorm": {"class": "layer_norm", "from": ["enc_004_ff1_out"]},
    "enc_004_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_004_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_004_self_att_out": {
        "class": "combine",
        "from": ["enc_004_ff1_out", "enc_004_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_005": {"class": "copy", "from": ["enc_005_ff2_out"]},
    "enc_005_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_005_conv_pointwise1"],
    },
    "enc_005_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_005_conv_layer_norm"],
    },
    "enc_005_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_005_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_005_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_005_conv_pointwise2"],
    },
    "enc_005_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_005_conv_depthwise"],
    },
    "enc_005_conv_laynorm": {"class": "layer_norm", "from": ["enc_005_self_att_out"]},
    "enc_005_conv_output": {
        "class": "combine",
        "from": ["enc_005_self_att_out", "enc_005_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_005_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_005_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_005_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_005_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_005_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_005_ff1_conv2"],
    },
    "enc_005_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_005_ff1_drop"],
    },
    "enc_005_ff1_laynorm": {"class": "layer_norm", "from": ["enc_004"]},
    "enc_005_ff1_out": {
        "class": "combine",
        "from": ["enc_004", "enc_005_ff1_drop_half"],
        "kind": "add",
    },
    "enc_005_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_005_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_005_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_005_ff2_conv2"],
    },
    "enc_005_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_005_ff2_drop"],
    },
    "enc_005_ff2_laynorm": {"class": "layer_norm", "from": ["enc_005_conv_output"]},
    "enc_005_ff2_out": {
        "class": "combine",
        "from": ["enc_005_conv_output", "enc_005_ff2_drop_half"],
        "kind": "add",
    },
    "enc_005_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_005_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_self_att_laynorm"],
        "key_shift": "enc_005_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_005_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_005_self_att_lin"],
    },
    "enc_005_self_att_laynorm": {"class": "layer_norm", "from": ["enc_005_ff1_out"]},
    "enc_005_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_005_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_005_self_att_out": {
        "class": "combine",
        "from": ["enc_005_ff1_out", "enc_005_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_006": {"class": "copy", "from": ["enc_006_ff2_out"]},
    "enc_006_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_006_conv_pointwise1"],
    },
    "enc_006_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_006_conv_layer_norm"],
    },
    "enc_006_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_006_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_006_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_006_conv_pointwise2"],
    },
    "enc_006_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_006_conv_depthwise"],
    },
    "enc_006_conv_laynorm": {"class": "layer_norm", "from": ["enc_006_self_att_out"]},
    "enc_006_conv_output": {
        "class": "combine",
        "from": ["enc_006_self_att_out", "enc_006_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_006_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_006_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_006_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_006_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_006_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_006_ff1_conv2"],
    },
    "enc_006_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_006_ff1_drop"],
    },
    "enc_006_ff1_laynorm": {"class": "layer_norm", "from": ["enc_005"]},
    "enc_006_ff1_out": {
        "class": "combine",
        "from": ["enc_005", "enc_006_ff1_drop_half"],
        "kind": "add",
    },
    "enc_006_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_006_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_006_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_006_ff2_conv2"],
    },
    "enc_006_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_006_ff2_drop"],
    },
    "enc_006_ff2_laynorm": {"class": "layer_norm", "from": ["enc_006_conv_output"]},
    "enc_006_ff2_out": {
        "class": "combine",
        "from": ["enc_006_conv_output", "enc_006_ff2_drop_half"],
        "kind": "add",
    },
    "enc_006_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_006_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_self_att_laynorm"],
        "key_shift": "enc_006_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_006_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_006_self_att_lin"],
    },
    "enc_006_self_att_laynorm": {"class": "layer_norm", "from": ["enc_006_ff1_out"]},
    "enc_006_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_006_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_006_self_att_out": {
        "class": "combine",
        "from": ["enc_006_ff1_out", "enc_006_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_007": {"class": "copy", "from": ["enc_007_ff2_out"]},
    "enc_007_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_007_conv_pointwise1"],
    },
    "enc_007_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_007_conv_layer_norm"],
    },
    "enc_007_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_007_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_007_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_007_conv_pointwise2"],
    },
    "enc_007_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_007_conv_depthwise"],
    },
    "enc_007_conv_laynorm": {"class": "layer_norm", "from": ["enc_007_self_att_out"]},
    "enc_007_conv_output": {
        "class": "combine",
        "from": ["enc_007_self_att_out", "enc_007_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_007_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_007_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_007_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_007_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_007_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_007_ff1_conv2"],
    },
    "enc_007_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_007_ff1_drop"],
    },
    "enc_007_ff1_laynorm": {"class": "layer_norm", "from": ["enc_006"]},
    "enc_007_ff1_out": {
        "class": "combine",
        "from": ["enc_006", "enc_007_ff1_drop_half"],
        "kind": "add",
    },
    "enc_007_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_007_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_007_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_007_ff2_conv2"],
    },
    "enc_007_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_007_ff2_drop"],
    },
    "enc_007_ff2_laynorm": {"class": "layer_norm", "from": ["enc_007_conv_output"]},
    "enc_007_ff2_out": {
        "class": "combine",
        "from": ["enc_007_conv_output", "enc_007_ff2_drop_half"],
        "kind": "add",
    },
    "enc_007_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_007_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_self_att_laynorm"],
        "key_shift": "enc_007_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_007_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_007_self_att_lin"],
    },
    "enc_007_self_att_laynorm": {"class": "layer_norm", "from": ["enc_007_ff1_out"]},
    "enc_007_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_007_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_007_self_att_out": {
        "class": "combine",
        "from": ["enc_007_ff1_out", "enc_007_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_008": {"class": "copy", "from": ["enc_008_ff2_out"]},
    "enc_008_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_008_conv_pointwise1"],
    },
    "enc_008_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_008_conv_layer_norm"],
    },
    "enc_008_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_008_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_008_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_008_conv_pointwise2"],
    },
    "enc_008_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_008_conv_depthwise"],
    },
    "enc_008_conv_laynorm": {"class": "layer_norm", "from": ["enc_008_self_att_out"]},
    "enc_008_conv_output": {
        "class": "combine",
        "from": ["enc_008_self_att_out", "enc_008_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_008_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_008_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_008_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_008_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_008_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_008_ff1_conv2"],
    },
    "enc_008_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_008_ff1_drop"],
    },
    "enc_008_ff1_laynorm": {"class": "layer_norm", "from": ["enc_007"]},
    "enc_008_ff1_out": {
        "class": "combine",
        "from": ["enc_007", "enc_008_ff1_drop_half"],
        "kind": "add",
    },
    "enc_008_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_008_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_008_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_008_ff2_conv2"],
    },
    "enc_008_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_008_ff2_drop"],
    },
    "enc_008_ff2_laynorm": {"class": "layer_norm", "from": ["enc_008_conv_output"]},
    "enc_008_ff2_out": {
        "class": "combine",
        "from": ["enc_008_conv_output", "enc_008_ff2_drop_half"],
        "kind": "add",
    },
    "enc_008_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_008_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_self_att_laynorm"],
        "key_shift": "enc_008_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_008_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_008_self_att_lin"],
    },
    "enc_008_self_att_laynorm": {"class": "layer_norm", "from": ["enc_008_ff1_out"]},
    "enc_008_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_008_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_008_self_att_out": {
        "class": "combine",
        "from": ["enc_008_ff1_out", "enc_008_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_009": {"class": "copy", "from": ["enc_009_ff2_out"]},
    "enc_009_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_009_conv_pointwise1"],
    },
    "enc_009_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_009_conv_layer_norm"],
    },
    "enc_009_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_009_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_009_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_009_conv_pointwise2"],
    },
    "enc_009_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_009_conv_depthwise"],
    },
    "enc_009_conv_laynorm": {"class": "layer_norm", "from": ["enc_009_self_att_out"]},
    "enc_009_conv_output": {
        "class": "combine",
        "from": ["enc_009_self_att_out", "enc_009_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_009_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_009_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_009_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_009_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_009_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_009_ff1_conv2"],
    },
    "enc_009_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_009_ff1_drop"],
    },
    "enc_009_ff1_laynorm": {"class": "layer_norm", "from": ["enc_008"]},
    "enc_009_ff1_out": {
        "class": "combine",
        "from": ["enc_008", "enc_009_ff1_drop_half"],
        "kind": "add",
    },
    "enc_009_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_009_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_009_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_009_ff2_conv2"],
    },
    "enc_009_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_009_ff2_drop"],
    },
    "enc_009_ff2_laynorm": {"class": "layer_norm", "from": ["enc_009_conv_output"]},
    "enc_009_ff2_out": {
        "class": "combine",
        "from": ["enc_009_conv_output", "enc_009_ff2_drop_half"],
        "kind": "add",
    },
    "enc_009_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_009_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_self_att_laynorm"],
        "key_shift": "enc_009_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_009_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_009_self_att_lin"],
    },
    "enc_009_self_att_laynorm": {"class": "layer_norm", "from": ["enc_009_ff1_out"]},
    "enc_009_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_009_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_009_self_att_out": {
        "class": "combine",
        "from": ["enc_009_ff1_out", "enc_009_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_010": {"class": "copy", "from": ["enc_010_ff2_out"]},
    "enc_010_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_010_conv_pointwise1"],
    },
    "enc_010_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_010_conv_layer_norm"],
    },
    "enc_010_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_010_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_010_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_010_conv_pointwise2"],
    },
    "enc_010_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_010_conv_depthwise"],
    },
    "enc_010_conv_laynorm": {"class": "layer_norm", "from": ["enc_010_self_att_out"]},
    "enc_010_conv_output": {
        "class": "combine",
        "from": ["enc_010_self_att_out", "enc_010_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_010_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_010_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_010_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_010_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_010_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_010_ff1_conv2"],
    },
    "enc_010_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_010_ff1_drop"],
    },
    "enc_010_ff1_laynorm": {"class": "layer_norm", "from": ["enc_009"]},
    "enc_010_ff1_out": {
        "class": "combine",
        "from": ["enc_009", "enc_010_ff1_drop_half"],
        "kind": "add",
    },
    "enc_010_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_010_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_010_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_010_ff2_conv2"],
    },
    "enc_010_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_010_ff2_drop"],
    },
    "enc_010_ff2_laynorm": {"class": "layer_norm", "from": ["enc_010_conv_output"]},
    "enc_010_ff2_out": {
        "class": "combine",
        "from": ["enc_010_conv_output", "enc_010_ff2_drop_half"],
        "kind": "add",
    },
    "enc_010_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_010_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_self_att_laynorm"],
        "key_shift": "enc_010_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_010_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_010_self_att_lin"],
    },
    "enc_010_self_att_laynorm": {"class": "layer_norm", "from": ["enc_010_ff1_out"]},
    "enc_010_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_010_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_010_self_att_out": {
        "class": "combine",
        "from": ["enc_010_ff1_out", "enc_010_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_011": {"class": "copy", "from": ["enc_011_ff2_out"]},
    "enc_011_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_011_conv_pointwise1"],
    },
    "enc_011_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_011_conv_layer_norm"],
    },
    "enc_011_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_011_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_011_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_011_conv_pointwise2"],
    },
    "enc_011_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_011_conv_depthwise"],
    },
    "enc_011_conv_laynorm": {"class": "layer_norm", "from": ["enc_011_self_att_out"]},
    "enc_011_conv_output": {
        "class": "combine",
        "from": ["enc_011_self_att_out", "enc_011_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_011_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_011_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_011_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_011_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_011_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_011_ff1_conv2"],
    },
    "enc_011_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_011_ff1_drop"],
    },
    "enc_011_ff1_laynorm": {"class": "layer_norm", "from": ["enc_010"]},
    "enc_011_ff1_out": {
        "class": "combine",
        "from": ["enc_010", "enc_011_ff1_drop_half"],
        "kind": "add",
    },
    "enc_011_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_011_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_011_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_011_ff2_conv2"],
    },
    "enc_011_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_011_ff2_drop"],
    },
    "enc_011_ff2_laynorm": {"class": "layer_norm", "from": ["enc_011_conv_output"]},
    "enc_011_ff2_out": {
        "class": "combine",
        "from": ["enc_011_conv_output", "enc_011_ff2_drop_half"],
        "kind": "add",
    },
    "enc_011_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_011_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_self_att_laynorm"],
        "key_shift": "enc_011_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_011_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_011_self_att_lin"],
    },
    "enc_011_self_att_laynorm": {"class": "layer_norm", "from": ["enc_011_ff1_out"]},
    "enc_011_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_011_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_011_self_att_out": {
        "class": "combine",
        "from": ["enc_011_ff1_out", "enc_011_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_012": {"class": "copy", "from": ["enc_012_ff2_out"]},
    "enc_012_conv_GLU": {
        "activation": "identity",
        "class": "gating",
        "from": ["enc_012_conv_pointwise1"],
    },
    "enc_012_conv_act": {
        "activation": "swish",
        "class": "activation",
        "from": ["enc_012_conv_layer_norm"],
    },
    "enc_012_conv_depthwise": {
        "activation": None,
        "class": "conv",
        "filter_size": (32,),
        "from": ["enc_012_conv_GLU"],
        "groups": 512,
        "n_out": 512,
        "padding": "same",
        "with_bias": True,
    },
    "enc_012_conv_dropout": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_012_conv_pointwise2"],
    },
    "enc_012_conv_layer_norm": {
        "class": "layer_norm",
        "from": ["enc_012_conv_depthwise"],
    },
    "enc_012_conv_laynorm": {"class": "layer_norm", "from": ["enc_012_self_att_out"]},
    "enc_012_conv_output": {
        "class": "combine",
        "from": ["enc_012_self_att_out", "enc_012_conv_dropout"],
        "kind": "add",
        "n_out": 512,
    },
    "enc_012_conv_pointwise1": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_conv_laynorm"],
        "n_out": 1024,
        "with_bias": False,
    },
    "enc_012_conv_pointwise2": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_conv_act"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_012_ff1_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_ff1_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_012_ff1_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_ff1_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_012_ff1_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_012_ff1_conv2"],
    },
    "enc_012_ff1_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_012_ff1_drop"],
    },
    "enc_012_ff1_laynorm": {"class": "layer_norm", "from": ["enc_011"]},
    "enc_012_ff1_out": {
        "class": "combine",
        "from": ["enc_011", "enc_012_ff1_drop_half"],
        "kind": "add",
    },
    "enc_012_ff2_conv1": {
        "activation": "swish",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_ff2_laynorm"],
        "n_out": 2048,
        "with_bias": True,
    },
    "enc_012_ff2_conv2": {
        "activation": None,
        "class": "linear",
        "dropout": 0.1,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_ff2_conv1"],
        "n_out": 512,
        "with_bias": True,
    },
    "enc_012_ff2_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_012_ff2_conv2"],
    },
    "enc_012_ff2_drop_half": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": ["enc_012_ff2_drop"],
    },
    "enc_012_ff2_laynorm": {"class": "layer_norm", "from": ["enc_012_conv_output"]},
    "enc_012_ff2_out": {
        "class": "combine",
        "from": ["enc_012_conv_output", "enc_012_ff2_drop_half"],
        "kind": "add",
    },
    "enc_012_rel_pos": {
        "class": "relative_positional_encoding",
        "clipping": 400,
        "fixed": False,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_self_att_laynorm"],
        "n_out": 64,
    },
    "enc_012_self_att_att": {
        "attention_dropout": 0.1,
        "attention_left_only": False,
        "class": "self_attention",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_self_att_laynorm"],
        "key_shift": "enc_012_rel_pos",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
    },
    "enc_012_self_att_drop": {
        "class": "dropout",
        "dropout": 0.1,
        "from": ["enc_012_self_att_lin"],
    },
    "enc_012_self_att_laynorm": {"class": "layer_norm", "from": ["enc_012_ff1_out"]},
    "enc_012_self_att_lin": {
        "activation": None,
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["enc_012_self_att_att"],
        "n_out": 512,
        "with_bias": False,
    },
    "enc_012_self_att_out": {
        "class": "combine",
        "from": ["enc_012_ff1_out", "enc_012_self_att_drop"],
        "kind": "add",
        "n_out": 512,
    },
    "encoder": {"class": "layer_norm", "from": ["enc_012"]},
    "encoder-output": {"class": "copy", "from": "length_masked"},
    "feature_stacking_merged": {
        "axes": (2, 3),
        "class": "merge_dims",
        "from": ["feature_stacking_window"],
    },
    "feature_stacking_window": {
        "class": "window",
        "from": ["conv_merged"],
        "stride": 3,
        "window_left": 2,
        "window_right": 0,
        "window_size": 3,
    },
    "futureLabel": {
        "class": "eval",
        "eval": "tf.math.floormod(source(0), 42)",
        "from": "data:classes",
        "out_type": {"dim": 42, "dtype": "int32", "sparse": True},
        "register_as_extern_data": "futureLabel",
    },
    "left-output": {
        "class": "softmax",
        "from": "linear2-leftContext",
        "loss": "ce",
        "loss_opts": {"focal_loss_factor": 2.0},
        "n_out": 42,
        "target": "pastLabel",
    },
    "length_masked": {
        "axis": "T",
        "class": "slice_nd",
        "from": ["upsampled0"],
        "size": __time_tag__,
        "start": 0,
    },
    "linear1-diphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["encoder-output", "pastEmbed"],
        "n_out": 544,
    },
    "linear1-leftContext": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "encoder-output",
        "n_out": 512,
    },
    "linear1-triphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": ["encoder-output", "currentState", "pastEmbed"],
        "n_out": 672,
    },
    "linear2-diphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "linear1-diphone",
        "n_out": 544,
    },
    "linear2-leftContext": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "linear1-leftContext",
        "n_out": 512,
    },
    "linear2-triphone": {
        "L2": 1e-06,
        "activation": "relu",
        "class": "linear",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_in', distribution='uniform', scale=0.78)",
        "from": "linear1-triphone",
        "n_out": 672,
    },
    "pastEmbed": {
        "L2": 1e-06,
        "activation": None,
        "class": "linear",
        "from": "pastLabel",
        "n_out": 32,
        "with_bias": False,
    },
    "pastLabel": {
        "class": "eval",
        "eval": "tf.math.floormod(source(0), 42)",
        "from": "popFutureLabel",
        "out_type": {"dim": 42, "dtype": "int32", "sparse": True},
        "register_as_extern_data": "pastLabel",
    },
    "popFutureLabel": {
        "class": "eval",
        "eval": "tf.math.floordiv(source(0), 42)",
        "from": "data:classes",
        "out_type": {"dim": 10584, "dtype": "int32", "sparse": True},
    },
    "popWordEnd": {
        "class": "eval",
        "eval": "tf.math.floordiv(source(0), 2)",
        "from": "centerState",
        "out_type": {"dim": 126, "dtype": "int32", "sparse": True},
    },
    "right-output": {
        "class": "softmax",
        "from": "linear2-triphone",
        "loss": "ce",
        "loss_opts": {"focal_loss_factor": 2.0},
        "n_out": 42,
        "target": "futureLabel",
    },
    "source": {
        "class": "eval",
        "eval": "self.network.get_config().typed_value('transform')(source(0), network=self.network)",
        "from": "data",
    },
    "source0": {
        "axis": "F",
        "class": "split_dims",
        "dims": (-1, 1),
        "from": ["source"],
    },
    "stateId": {
        "class": "eval",
        "eval": "tf.math.floormod(source(0), 3)",
        "from": "popWordEnd",
        "out_type": {"dim": 3, "dtype": "int32", "sparse": True},
    },
    "upsampled0": {
        "activation": "relu",
        "class": "transposed_conv",
        "filter_size": (3,),
        "from": ["encoder"],
        "n_out": 512,
        "strides": (3,),
        "with_bias": True,
    },
    "wordEndClass": {
        "class": "eval",
        "eval": "tf.math.floormod(source(0), 2)",
        "from": "centerState",
        "out_type": {"dim": 2, "dtype": "int32", "sparse": True},
    },
}
num_epochs = 600
num_input = 50
optimizer = {"class": "nadam"}
optimizer_epsilon = 1e-08
save_interval = 1
target = "classes"
task = "train"
tf_log_memory_usage = True
train = {
    "class": "ExternSprintDataset",
    "partitionEpoch": 40,
    "sprintConfigStr": "--config=rasr.train.config --*.LOGFILE=nn-trainer.train.log --*.TASK=1",
    "sprintTrainerExecPath": "/u/raissi/dev/rasr_github/rasr_tf2/arch/linux-x86_64-standard/nn-trainer.linux-x86_64-standard",
}
update_on_device = True
use_tensorflow = True
window = 1
config = {}

locals().update(**config)


def mask(x, axis, pos, max_amount):
    """
    :param tf.Tensor x: (batch,time,feature)
    :param int axis:
    :param tf.Tensor pos: (batch,)
    :param int max_amount: inclusive
    """
    import tensorflow as tf

    ndim = x.get_shape().ndims
    n_batch = tf.shape(x)[0]
    dim = tf.shape(x)[axis]
    # amount = tf.random_uniform(shape=(n_batch,), minval=1, maxval=max_amount + 1, dtype=tf.int32)
    amount = tf.random.uniform(
        shape=(n_batch,), minval=1, maxval=max_amount + 1, dtype=tf.int32
    )
    pos2 = tf.minimum(pos + amount, dim)
    idxs = tf.expand_dims(tf.range(0, dim), 0)  # (1,dim)
    pos_bc = tf.expand_dims(pos, 1)  # (batch,1)
    pos2_bc = tf.expand_dims(pos2, 1)  # (batch,1)
    cond = tf.logical_and(
        tf.greater_equal(idxs, pos_bc), tf.less(idxs, pos2_bc)
    )  # (batch,dim)
    cond = tf.reshape(
        cond, [tf.shape(x)[i] if i in (0, axis) else 1 for i in range(ndim)]
    )
    from TFUtil import where_bc

    x = where_bc(cond, 0.0, x)
    return x


def random_mask(x, axis, min_num, max_num, max_dims):
    """
    :param tf.Tensor x: (batch,time,feature)
    :param int axis:
    :param int|tf.Tensor min_num:
    :param int|tf.Tensor max_num: inclusive
    :param int max_dims: inclusive
    """
    import tensorflow as tf

    n_batch = tf.shape(x)[0]
    # num = tf.random_uniform(shape=(n_batch,), minval=min_num, maxval=max_num + 1, dtype=tf.int32)
    num = tf.random.uniform(
        shape=(n_batch,), minval=min_num, maxval=max_num + 1, dtype=tf.int32
    )
    # https://github.com/tensorflow/tensorflow/issues/9260
    # https://timvieira.github.io/blog/post/2014/08/01/gumbel-max-trick-and-weighted-reservoir-sampling/
    # z = -tf.log(-tf.log(tf.random_uniform((n_batch, tf.shape(x)[axis]), 0, 1)))
    z = -tf.math.log(
        -tf.math.log(tf.random.uniform((n_batch, tf.shape(x)[axis]), 0, 1))
    )

    ## if the time axis dim. is smaller than maxval - 1
    # num = tf.cond(tf.less(tf.shape(x)[axis], max_num), lambda: tf.random_uniform(shape=(n_batch,), minval=min_num, maxval=tf.shape(x)[axis] + 1, dtype=tf.int32), lambda: num)
    num = tf.cond(
        tf.less(tf.shape(x)[axis], max_num),
        lambda: tf.random.uniform(
            shape=(n_batch,),
            minval=min_num,
            maxval=tf.shape(x)[axis] + 1,
            dtype=tf.int32,
        ),
        lambda: num,
    )

    _, indices = tf.nn.top_k(z, tf.reduce_max(num))
    # indices should be sorted, and of shape (batch,num), entries (int32) in [0,dim)
    # indices = tf.Print(indices, ["indices", indices, tf.shape(indices)])
    _, x = tf.while_loop(
        cond=lambda i, _: tf.less(i, tf.reduce_max(num)),
        body=lambda i, x: (
            i + 1,
            tf.compat.v1.where(
                tf.less(i, num),
                mask(x, axis=axis, pos=indices[:, i], max_amount=max_dims),
                x,
            ),
        ),
        loop_vars=(0, x),
    )
    return x


def summary(name, x):
    """
    :param str name:
    :param tf.Tensor x: (batch,time,feature)
    """
    import tensorflow as tf

    # tf.summary.image wants [batch_size, height,  width, channels],
    # we have (batch, time, feature).
    img = tf.expand_dims(x, axis=3)  # (batch,time,feature,1)
    img = tf.transpose(img, [0, 2, 1, 3])  # (batch,feature,time,1)
    tf.summary.image(name, img, max_outputs=10)
    tf.summary.scalar("%s_max_abs" % name, tf.reduce_max(tf.abs(x)))
    mean = tf.reduce_mean(x)
    tf.summary.scalar("%s_mean" % name, mean)
    stddev = tf.sqrt(tf.reduce_mean(tf.square(x - mean)))
    tf.summary.scalar("%s_stddev" % name, stddev)
    tf.summary.histogram("%s_hist" % name, tf.reduce_max(tf.abs(x), axis=2))


def transform(x, network):
    import tensorflow as tf

    # summary("features", x)
    # x = tf.clip_by_value(x, -3.0, 3.0)
    # summary("features_clip", x)

    max_reps_time = network.get_config().typed_value("max_reps_time")
    min_reps_time = network.get_config().typed_value("min_reps_time")
    max_reps_feature = network.get_config().typed_value("max_reps_feature")
    min_reps_feature = network.get_config().typed_value("min_reps_feature")

    max_len_time = network.get_config().typed_value("max_len_time")
    max_len_feature = network.get_config().typed_value("max_len_feature")

    # number of repetitions for time masking
    if max_reps_time is None:
        max_reps_time = tf.maximum(
            tf.shape(x)[1] // (max_len_time or 20), 1
        )  # // 100, 1)
    if min_reps_time is None:
        min_reps_time = 1

    # number of repetitions for feature masking
    if max_reps_feature is None:
        max_reps_feature = 2
    if min_reps_feature is None:
        min_reps_feature = 1

    # length of time masking
    if max_len_time is None:
        max_len_time = 20
    # length of feature masking
    if max_len_feature is None:
        max_len_feature = tf.shape(x)[-1] // 5

    def get_masked():
        x_masked = x
        x_masked = random_mask(
            x_masked,
            axis=1,
            min_num=min_reps_time,
            max_num=max_reps_time,
            max_dims=max_len_time,
        )
        x_masked = random_mask(
            x_masked,
            axis=2,
            min_num=min_reps_feature,
            max_num=max_reps_feature,
            max_dims=max_len_feature,
        )
        # summary("features_mask", x_masked)
        return x_masked

    x = network.cond_on_train(get_masked, lambda: x)

    return x
